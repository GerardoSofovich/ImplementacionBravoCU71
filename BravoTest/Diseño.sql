/* ---------------------------------------------------- */
/*  Generated by Enterprise Architect Version 13.5 		*/
/*  Created On : 05-nov.-2019 0:45:45 				*/
/*  DBMS       : SQL Server 2008 						*/
/* ---------------------------------------------------- */

/* Drop Foreign Key Constraints */

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[FK_BOMBEROS_ROLES]') AND OBJECTPROPERTY(id, N'IsForeignKey') = 1) 
ALTER TABLE [BOMBEROS] DROP CONSTRAINT [FK_BOMBEROS_ROLES]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[FK_BOMBEROSº_USUARIOS]') AND OBJECTPROPERTY(id, N'IsForeignKey') = 1) 
ALTER TABLE [BOMBEROS] DROP CONSTRAINT [FK_BOMBEROSº_USUARIOS]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[FK_BOMBEROS_INTERVENCION_BOMBEROSº]') AND OBJECTPROPERTY(id, N'IsForeignKey') = 1) 
ALTER TABLE [BOMBEROS_INTERVENCION] DROP CONSTRAINT [FK_BOMBEROS_INTERVENCION_BOMBEROSº]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[FK_BOMBEROS_INTERVENCION_INTERVENCIONES]') AND OBJECTPROPERTY(id, N'IsForeignKey') = 1) 
ALTER TABLE [BOMBEROS_INTERVENCION] DROP CONSTRAINT [FK_BOMBEROS_INTERVENCION_INTERVENCIONES]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[FK_HISTORIALES_INTERVENCION_ESTADOS]') AND OBJECTPROPERTY(id, N'IsForeignKey') = 1) 
ALTER TABLE [HISTORIALES_INTERVENCION] DROP CONSTRAINT [FK_HISTORIALES_INTERVENCION_ESTADOS]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[FK_HISTORIALES_INTERVENCION_INTERVENCIONES]') AND OBJECTPROPERTY(id, N'IsForeignKey') = 1) 
ALTER TABLE [HISTORIALES_INTERVENCION] DROP CONSTRAINT [FK_HISTORIALES_INTERVENCION_INTERVENCIONES]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[FK_INTERVENCIONES_ESTADOS]') AND OBJECTPROPERTY(id, N'IsForeignKey') = 1) 
ALTER TABLE [INTERVENCIONES] DROP CONSTRAINT [FK_INTERVENCIONES_ESTADOS]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[FK_INTERVENCIONES_GRAVEDADES]') AND OBJECTPROPERTY(id, N'IsForeignKey') = 1) 
ALTER TABLE [INTERVENCIONES] DROP CONSTRAINT [FK_INTERVENCIONES_GRAVEDADES]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[FK_INTERVENCIONES_TIPOS_SINIESTRO]') AND OBJECTPROPERTY(id, N'IsForeignKey') = 1) 
ALTER TABLE [INTERVENCIONES] DROP CONSTRAINT [FK_INTERVENCIONES_TIPOS_SINIESTRO]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[FK_SESIONES_USUARIOS]') AND OBJECTPROPERTY(id, N'IsForeignKey') = 1) 
ALTER TABLE [SESIONES] DROP CONSTRAINT [FK_SESIONES_USUARIOS]
GO

/* Drop Tables */

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[BOMBEROS]') AND OBJECTPROPERTY(id, N'IsUserTable') = 1) 
DROP TABLE [BOMBEROS]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[BOMBEROS_INTERVENCION]') AND OBJECTPROPERTY(id, N'IsUserTable') = 1) 
DROP TABLE [BOMBEROS_INTERVENCION]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[ESTADOS]') AND OBJECTPROPERTY(id, N'IsUserTable') = 1) 
DROP TABLE [ESTADOS]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[GRAVEDADES]') AND OBJECTPROPERTY(id, N'IsUserTable') = 1) 
DROP TABLE [GRAVEDADES]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[HISTORIALES_INTERVENCION]') AND OBJECTPROPERTY(id, N'IsUserTable') = 1) 
DROP TABLE [HISTORIALES_INTERVENCION]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[INTERVENCIONES]') AND OBJECTPROPERTY(id, N'IsUserTable') = 1) 
DROP TABLE [INTERVENCIONES]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[ROLES]') AND OBJECTPROPERTY(id, N'IsUserTable') = 1) 
DROP TABLE [ROLES]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[SESIONES]') AND OBJECTPROPERTY(id, N'IsUserTable') = 1) 
DROP TABLE [SESIONES]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[TIEMPOS_ANALISIS]') AND OBJECTPROPERTY(id, N'IsUserTable') = 1) 
DROP TABLE [TIEMPOS_ANALISIS]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[TIPOS_SINIESTRO]') AND OBJECTPROPERTY(id, N'IsUserTable') = 1) 
DROP TABLE [TIPOS_SINIESTRO]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[USUARIOS]') AND OBJECTPROPERTY(id, N'IsUserTable') = 1) 
DROP TABLE [USUARIOS]
GO

/* Create Tables */

CREATE TABLE [BOMBEROS]
(
	[activo] bit NOT NULL,
	[apellido] varchar(50) NOT NULL,
	[nombre] varchar(50) NOT NULL,
	[nombreUsuario] varchar(50) NOT NULL,
	[direccion] varchar(300) NOT NULL,
	[dni] numeric(10,0) NOT NULL,
	[email] varchar(50) NOT NULL,
	[fechaNacimiento] date NOT NULL,
	[telefono] numeric(10,0) NOT NULL,
	[idRol] int NULL
)
GO

CREATE TABLE [BOMBEROS_INTERVENCION]
(
	[idIntervencion] int NOT NULL,
	[dni] numeric(10,0) NOT NULL
)
GO

CREATE TABLE [ESTADOS]
(
	[idEstado] int NOT NULL IDENTITY (1, 1),
	[ambito] varchar(50) NULL,
	[descripcion] varchar(300) NULL,
	[nombre] varchar(50) NOT NULL
)
GO

CREATE TABLE [GRAVEDADES]
(
	[nombre] varchar(50) NOT NULL,
	[descripcion] varchar(50),
	[idGravedad] int NOT NULL IDENTITY (1, 1)
)
GO

CREATE TABLE [HISTORIALES_INTERVENCION]
(
	[fechaHoraDesde] datetime NOT NULL,
	[idHistorialIntervencion] int NOT NULL IDENTITY (1, 1),
	[idIntervencion] int NOT NULL,
	[idEstado] int NULL,
	[nombre] varchar(50) NULL
)
GO

CREATE TABLE [INTERVENCIONES]
(
	[domicilioReportado] varchar(300) NOT NULL,
	[nombreApellidoInformante] varchar(300) NOT NULL,
	[resumenSiniestroInformante] varchar(2000) NULL,
	[resumenTrabajoEfectuado] varchar(2000) NULL,
	[telefonoContacto] varchar(10) NOT NULL,
	[idGravedad] int NULL,
	[idIntervencion] int NOT NULL IDENTITY (1, 1),
	[idTipoSiniestro] int NULL,
	[idEstadoActual] int NULL,
	[nombre] varchar(50) NULL
)
GO

CREATE TABLE [ROLES]
(
	[idRol] int NOT NULL IDENTITY (1, 1),
	[nombre] varchar(50) NOT NULL
)
GO

CREATE TABLE [SESIONES]
(
	[fechaDesde] date NOT NULL,
	[fechaHasta] date NOT NULL,
	[idSession] int NOT NULL IDENTITY (1, 1),
	[nombre] varchar(50) NULL
)
GO

CREATE TABLE [TIEMPOS_ANALISIS]
(
	[descripcion] varchar(300) NULL,
	[nombre] varchar(50) NULL,
	[idTiempoAnalisis] int NOT NULL IDENTITY (1, 1)
)
GO

CREATE TABLE [TIPOS_SINIESTRO]
(
	[idTipoSiniestro] int NOT NULL IDENTITY (1, 1),
	[nombre] varchar(50) NOT NULL,
	[descripcion] varchar(300) NULL
)
GO

CREATE TABLE [USUARIOS]
(
	[nombre] varchar(50) NOT NULL,
	[contraseña] varchar(50) NOT NULL,
	[fechaAlta] date NOT NULL
)
GO

/* Create Primary Keys, Indexes, Uniques, Checks */

ALTER TABLE [BOMBEROS] 
 ADD CONSTRAINT [PK_BOMBEROSº]
	PRIMARY KEY CLUSTERED ([dni] ASC)
GO

CREATE NONCLUSTERED INDEX [IXFK_BOMBEROS_ROLES] 
 ON [BOMBEROS] ([idRol] ASC)
GO

CREATE NONCLUSTERED INDEX [IXFK_BOMBEROSº_USUARIOS] 
 ON [BOMBEROS] ([nombreUsuario] ASC)
GO

ALTER TABLE [BOMBEROS_INTERVENCION] 
 ADD CONSTRAINT [PK_BOMBEROS_INTERVENCION]
	PRIMARY KEY CLUSTERED ([idIntervencion] ASC,[dni] ASC)
GO

CREATE NONCLUSTERED INDEX [IXFK_BOMBEROS_INTERVENCION_BOMBEROSº] 
 ON [BOMBEROS_INTERVENCION] ([dni] ASC)
GO

CREATE NONCLUSTERED INDEX [IXFK_BOMBEROS_INTERVENCION_INTERVENCIONES] 
 ON [BOMBEROS_INTERVENCION] ([idIntervencion] ASC)
GO

ALTER TABLE [ESTADOS] 
 ADD CONSTRAINT [PK_ESTADOS]
	PRIMARY KEY CLUSTERED ([idEstado] ASC,[nombre] ASC)
GO

ALTER TABLE [GRAVEDADES] 
 ADD CONSTRAINT [PK_GRAVEDADES]
	PRIMARY KEY CLUSTERED ([idGravedad] ASC)
GO

ALTER TABLE [HISTORIALES_INTERVENCION] 
 ADD CONSTRAINT [PK_HISTORIALES_INTERVENCION]
	PRIMARY KEY CLUSTERED ([idHistorialIntervencion] ASC)
GO

CREATE NONCLUSTERED INDEX [IXFK_HISTORIALES_INTERVENCION_ESTADOS] 
 ON [HISTORIALES_INTERVENCION] ([idEstado] ASC,[nombre] ASC)
GO

CREATE NONCLUSTERED INDEX [IXFK_HISTORIALES_INTERVENCION_INTERVENCIONES] 
 ON [HISTORIALES_INTERVENCION] ([idIntervencion] ASC)
GO

ALTER TABLE [INTERVENCIONES] 
 ADD CONSTRAINT [PK_INTERVENCIONES]
	PRIMARY KEY CLUSTERED ([idIntervencion] ASC)
GO

CREATE NONCLUSTERED INDEX [IXFK_INTERVENCIONES_ESTADOS] 
 ON [INTERVENCIONES] ([idEstadoActual] ASC,[nombre] ASC)
GO

CREATE NONCLUSTERED INDEX [IXFK_INTERVENCIONES_GRAVEDADES] 
 ON [INTERVENCIONES] ([idGravedad] ASC)
GO

CREATE NONCLUSTERED INDEX [IXFK_INTERVENCIONES_TIPOS_SINIESTRO] 
 ON [INTERVENCIONES] ([idTipoSiniestro] ASC)
GO

ALTER TABLE [ROLES] 
 ADD CONSTRAINT [PK_ROLES]
	PRIMARY KEY CLUSTERED ([idRol] ASC)
GO

ALTER TABLE [SESIONES] 
 ADD CONSTRAINT [PK_SESIONES]
	PRIMARY KEY CLUSTERED ([idSession] ASC)
GO

CREATE NONCLUSTERED INDEX [IXFK_SESIONES_USUARIOS] 
 ON [SESIONES] ([nombre] ASC)
GO

ALTER TABLE [TIEMPOS_ANALISIS] 
 ADD CONSTRAINT [PK_TIEMPOS_ANALISIS]
	PRIMARY KEY CLUSTERED ([idTiempoAnalisis] ASC)
GO

ALTER TABLE [TIPOS_SINIESTRO] 
 ADD CONSTRAINT [PK_TIPOS_SINIESTRO]
	PRIMARY KEY CLUSTERED ([idTipoSiniestro] ASC)
GO

ALTER TABLE [USUARIOS] 
 ADD CONSTRAINT [PK_USUARIOS]
	PRIMARY KEY CLUSTERED ([nombre] ASC)
GO

/* Create Foreign Key Constraints */

ALTER TABLE [BOMBEROS] ADD CONSTRAINT [FK_BOMBEROS_ROLES]
	FOREIGN KEY ([idRol]) REFERENCES [ROLES] ([idRol]) ON DELETE No Action ON UPDATE No Action
GO

ALTER TABLE [BOMBEROS] ADD CONSTRAINT [FK_BOMBEROSº_USUARIOS]
	FOREIGN KEY ([nombreUsuario]) REFERENCES [USUARIOS] ([nombre]) ON DELETE No Action ON UPDATE No Action
GO

ALTER TABLE [BOMBEROS_INTERVENCION] ADD CONSTRAINT [FK_BOMBEROS_INTERVENCION_BOMBEROSº]
	FOREIGN KEY ([dni]) REFERENCES [BOMBEROS] ([dni]) ON DELETE No Action ON UPDATE No Action
GO

ALTER TABLE [BOMBEROS_INTERVENCION] ADD CONSTRAINT [FK_BOMBEROS_INTERVENCION_INTERVENCIONES]
	FOREIGN KEY ([idIntervencion]) REFERENCES [INTERVENCIONES] ([idIntervencion]) ON DELETE No Action ON UPDATE No Action
GO

ALTER TABLE [HISTORIALES_INTERVENCION] ADD CONSTRAINT [FK_HISTORIALES_INTERVENCION_ESTADOS]
	FOREIGN KEY ([idEstado],[nombre]) REFERENCES [ESTADOS] ([idEstado],[nombre]) ON DELETE No Action ON UPDATE No Action
GO

ALTER TABLE [HISTORIALES_INTERVENCION] ADD CONSTRAINT [FK_HISTORIALES_INTERVENCION_INTERVENCIONES]
	FOREIGN KEY ([idIntervencion]) REFERENCES [INTERVENCIONES] ([idIntervencion]) ON DELETE No Action ON UPDATE No Action
GO

ALTER TABLE [INTERVENCIONES] ADD CONSTRAINT [FK_INTERVENCIONES_ESTADOS]
	FOREIGN KEY ([idEstadoActual],[nombre]) REFERENCES [ESTADOS] ([idEstado],[nombre]) ON DELETE No Action ON UPDATE No Action
GO

ALTER TABLE [INTERVENCIONES] ADD CONSTRAINT [FK_INTERVENCIONES_GRAVEDADES]
	FOREIGN KEY ([idGravedad]) REFERENCES [GRAVEDADES] ([idGravedad]) ON DELETE No Action ON UPDATE No Action
GO

ALTER TABLE [INTERVENCIONES] ADD CONSTRAINT [FK_INTERVENCIONES_TIPOS_SINIESTRO]
	FOREIGN KEY ([idTipoSiniestro]) REFERENCES [TIPOS_SINIESTRO] ([idTipoSiniestro]) ON DELETE No Action ON UPDATE No Action
GO

ALTER TABLE [SESIONES] ADD CONSTRAINT [FK_SESIONES_USUARIOS]
	FOREIGN KEY ([nombre]) REFERENCES [USUARIOS] ([nombre]) ON DELETE No Action ON UPDATE No Action
GO


INSERT INTO ESTADOS (NOMBRE, DESCRIPCION, AMBITO) VALUES ('Informada', 'Estado inicial. El siniestro fue informado pero no se han convocado a los bomberos', 'INTERVENCION');
INSERT INTO ESTADOS (NOMBRE, DESCRIPCION, AMBITO) VALUES ('Cancelado', 'No fue necesaria la intervención del cuerpo de bomberos', 'INTERVENCION');
INSERT INTO ESTADOS (NOMBRE, DESCRIPCION, AMBITO) VALUES ('Convocado', 'Los bomberos han sido notificados para intervenir en el siniestro', 'INTERVENCION');
INSERT INTO ESTADOS (NOMBRE, DESCRIPCION, AMBITO) VALUES ('Firmada', 'Estado final. Los reportes han sido finalizados', 'INTERVENCION');
INSERT INTO ESTADOS (NOMBRE, DESCRIPCION, AMBITO) VALUES ('Finalizada', 'Los bomberos convocados volvieron al cuartel luego de la intervención', 'INTERVENCION');
INSERT INTO ESTADOS (NOMBRE, DESCRIPCION, AMBITO) VALUES ('Abortada', 'Cancelar una intervención en curso', 'INTERVENCION');
INSERT INTO ESTADOS (NOMBRE, DESCRIPCION, AMBITO) VALUES ('EnCurso', 'Los bomberos convcados han salido hacia el lugar del siniestro.', 'INTERVENCION');

INSERT INTO USUARIOS (NOMBRE, FECHAALTA, CONTRASEÑA) VALUES ('ARODRIGUEZ', '05/11/2019', '123456');
INSERT INTO USUARIOS (NOMBRE, FECHAALTA, CONTRASEÑA) VALUES ('SPESCETTI', '05/11/2019', '123456');
INSERT INTO USUARIOS (NOMBRE, FECHAALTA, CONTRASEÑA) VALUES ('NPIGUILLEM', '05/11/2019', '123456');
INSERT INTO USUARIOS (NOMBRE, FECHAALTA, CONTRASEÑA) VALUES ('AVERA', '05/11/2019', '123456');
INSERT INTO USUARIOS (NOMBRE, FECHAALTA, CONTRASEÑA) VALUES ('RSOSA', '05/11/2019', '123456');

INSERT INTO ROLES (NOMBRE) VALUES ('BOMBERO');
INSERT INTO ROLES (NOMBRE) VALUES ('JEFE CUERPO ACTIVO');
INSERT INTO ROLES (NOMBRE) VALUES ('ENCARGADO DE GUARDIA');
INSERT INTO ROLES (NOMBRE) VALUES ('ENCARGADO DE INTERVENCIÓN');

INSERT INTO TIPOS_SINIESTRO(NOMBRE) VALUES ('INCENDIOS');
INSERT INTO TIPOS_SINIESTRO(NOMBRE) VALUES ('ACCIDENTES VIALES');
INSERT INTO TIPOS_SINIESTRO(NOMBRE) VALUES ('RESCATES');
INSERT INTO TIPOS_SINIESTRO(NOMBRE) VALUES ('EVACUACIONES');
INSERT INTO TIPOS_SINIESTRO(NOMBRE) VALUES ('SIMULACROS');


INSERT INTO GRAVEDADES (NOMBRE) VALUES ('BAJA');
INSERT INTO GRAVEDADES (NOMBRE) VALUES ('MEDIA');
INSERT INTO GRAVEDADES (NOMBRE) VALUES ('ALTA');



INSERT INTO BOMBEROS (ACTIVO, NOMBRE, APELLIDO, DIRECCION, DNI, EMAIL, FECHANACIMIENTO, TELEFONO, NOMBREUSUARIO, IDROL) VALUES (1, 'Alejandro', 'Rodiguez', 'Av Maipú 113', 61142, 'ale-9108@hotmail.com', '11/11/1991', 3573513406, 'ARODRIGUEZ', 1);
INSERT INTO BOMBEROS (ACTIVO, NOMBRE, APELLIDO, DIRECCION, DNI, EMAIL, FECHANACIMIENTO, TELEFONO, NOMBREUSUARIO, IDROL) VALUES (1, 'Sabrina', 'Pescetti', 'Bv Illia 534', 55121, 'sabrinapescetti@gmail.com', '15/03/1990', 3456789654, 'SPESCETTI', 2);
INSERT INTO BOMBEROS (ACTIVO, NOMBRE, APELLIDO, DIRECCION, DNI, EMAIL, FECHANACIMIENTO, TELEFONO, NOMBREUSUARIO, IDROL) VALUES (1, 'Nahuel Nicolás', 'Piguillem', 'Rondeau 987', 77460, 'nahuel.n.piguillem@gmail.com', '03/02/1997', 3514567894, 'NPIGUILLEM', 3);
INSERT INTO BOMBEROS (ACTIVO, NOMBRE, APELLIDO, DIRECCION, DNI, EMAIL, FECHANACIMIENTO, TELEFONO, NOMBREUSUARIO, IDROL) VALUES (1, 'Azul', 'Vera', 'Rivera Indarte 987', 75865, 'azul.vela.junio@gmail.com', '23/05/1998', 3519871235, 'AVERA', 4);
INSERT INTO BOMBEROS (ACTIVO, NOMBRE, APELLIDO, DIRECCION, DNI, EMAIL, FECHANACIMIENTO, TELEFONO, NOMBREUSUARIO, IDROL) VALUES (1, 'Rocio Nicolle', 'Sosa', 'Salta 951',75223 , 'nicolle982010@gmail.com', '15/10/1995', 3514789335, 'RSOSA', 2);
